(window.webpackJsonp=window.webpackJsonp||[]).push([[78],{1031:function(t,e,n){"use strict";n(23);e.a=function(t){return new Promise((function(e,n){var r=new FileReader;r.readAsDataURL(t),r.onload=function(){return e(r.result)},r.onerror=function(t){return n(t)}}))}},1167:function(t,e,n){var content=n(2278);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(13).default)("4668d542",content,!0,{sourceMap:!1})},2277:function(t,e,n){"use strict";var r=n(1167);n.n(r).a},2278:function(t,e,n){(e=n(12)(!1)).push([t.i,".image_patina .nya-subtitle{margin-top:.9375rem}.image_patina .vue-slider{margin-bottom:.9375rem}.image_patina .preview{width:100%;font-size:0;display:flex;justify-content:space-between}.image_patina .preview .nya-subtitle{padding:0}.image_patina .preview div{width:50%;padding:0 1.25rem;box-sizing:border-box;display:inline-block}@media (max-width:600px){.image_patina .preview{display:block}.image_patina .preview div{width:100%;display:block}}.image_patina .preview img{width:100%}",""]),t.exports=e},2735:function(t,e,n){"use strict";n.r(e);var r=n(257),l=n(1031),o={name:"ImagePatina",head:function(){return this.$store.state.currentTool.head},data:function(){return{n:null,file:null,progress:0,iterations:16,quality:75,image:null,preview:"",resultsImg:"",loading:!1}},computed:{},watch:{quality:function(){this.resetProcess()}},mounted:function(){this.cover()},methods:{reset:function(){this.file=null,this.progress=0,this.iterations=16,this.quality=75,this.image=null,this.preview="",this.resultsImg="",this.loading=!1,this.cover()},handleChange:function(t){var e=this,n=t.target.files;if(!n.length)return!1;var r=n[0];this.file=r,Object(l.a)(r).then((function(t){e.preview=t,e.resetProcess()}))},download:function(){if(this.image.src){var t=this.n.lastIndexOf("."),e=(-1==t?this.n:this.n.substring(0,t))+(this.quality<=100?"_JPEGreen.jpg":"_JPEGreen.png");Object(r.a)(this.image.src,e)}},cover:function(){var t=this;this.image=new Image,this.image.addEventListener("load",(function(){requestAnimationFrame(t.processImage)}))},update:function(){if(!this.file)return!1;this.progress<=this.iterations?requestAnimationFrame(this.processImage):this.resetProcess()},resetProcess:function(){this.progress=0,this.image.src=this.preview},processImage:function(){this.loading=!0;var t=function(t){return t>=0?t<=255?t:255:0},e=function(t){return t>=-128?t<=127?t:127:-128},canvas=document.createElement("canvas"),n=canvas.getContext("2d");if(this.progress!=this.iterations){++this.progress,canvas.width=this.image.width,canvas.height=this.image.height,n.fillStyle="white",n.fillRect(0,0,this.image.width,this.image.height),n.drawImage(this.image,0,0);for(var r=n.getImageData(0,0,this.image.width,this.image.height),data=r.data,p=0;p<data.length/4;++p){var l=data[4*p],g=data[4*p+1],b=data[4*p+2],o=t(77*l+150*g+29*b>>8),u=e((-43*l-85*g+128*b>>8)-1),c=e((128*l-107*g-21*b>>8)-1),h=t(65536*o+91881*c>>16),d=t(65536*o-22553*u-46802*c>>16),m=t(65536*o+116130*u>>16);data[4*p]=h,data[4*p+1]=d,data[4*p+2]=m}n.putImageData(r,0,0);var v=this.quality<=100?canvas.toDataURL("image/jpeg",.01*this.quality):canvas.toDataURL("image/png");this.resultsImg=v,this.image.src=v}else this.loading=!1}}},c=(n(2277),n(5)),component=Object(c.a)(o,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"image_patina"},[n("nya-container",{attrs:{title:"图片加包浆"}},[n("div",{staticClass:"nya-subtitle mt-0"},[t._v("\n            请选择要处理的图片\n        ")]),n("el-input",{attrs:{type:"file",accept:"image/*",disabled:t.loading,placeholder:t.n?t.n.replace(/C:\\fakepath\\/,""):"点击这里上传文件",clearable:""},on:{clear:t.reset},nativeOn:{change:function(e){return t.handleChange(e)}},model:{value:t.n,callback:function(e){t.n=e},expression:"n"}},[n("el-button",{attrs:{slot:"append",loading:t.loading},on:{click:t.download},slot:"append"},[t._v("\n                "+t._s(t.loading?(t.progress/t.iterations*100).toFixed(0)+" %":"保存")+"\n            ")])],1),n("div",{staticClass:"nya-subtitle mb-0"},[t._v("\n            图片质量\n        ")]),n("el-slider",{attrs:{min:0,max:100},model:{value:t.quality,callback:function(e){t.quality=e},expression:"quality"}}),n("div",{staticClass:"nya-subtitle mt-0"},[t._v("\n            包浆次数\n        ")]),n("el-input-number",{staticClass:"full-width",on:{change:t.update},model:{value:t.iterations,callback:function(e){t.iterations=e},expression:"iterations"}})],1),t.preview?n("nya-container",{attrs:{title:"预览"}},[n("div",{staticClass:"preview"},[n("div",[n("div",{staticClass:"nya-subtitle"},[t._v("\n                    处理前\n                ")]),n("img",{attrs:{src:t.preview,alt:"image"}})]),n("div",[n("div",{staticClass:"nya-subtitle"},[t._v("\n                    处理后\n                ")]),n("img",{attrs:{src:t.resultsImg,alt:"image"}})])])]):t._e(),n("nya-container",{attrs:{title:"说明"}},[n("ul",{staticClass:"nya-list"},[n("li",[t._v("为什么要写这个功能可以参考："),n("a",{attrs:{href:"https://www.zhihu.com/question/29345490",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://www.zhihu.com/question/29345490")])]),n("li",[t._v("新做的表情包没人用？表情包没有年代感？这时即可使用本工具把图片做旧，让表情包看起来传播次数更多，更有收藏价值")]),n("li",[t._v("如果处理时间过长或处理失败，请使用其他浏览器，推荐使用 Chrome")])])])],1)}),[],!1,null,null,null);e.default=component.exports}}]);