(window.webpackJsonp=window.webpackJsonp||[]).push([[155],{1230:function(t,n,e){var content=e(2609);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,e(13).default)("a282b73a",content,!0,{sourceMap:!1})},2608:function(t,n,e){"use strict";var o=e(1230);e.n(o).a},2609:function(t,n,e){(n=e(12)(!1)).push([t.i,".user-index .aff-link{cursor:pointer}.user-index .nya-loading{margin:2.5rem auto}",""]),t.exports=n},2799:function(t,n,e){"use strict";e.r(n);e(31),e(23),e(43);var o=e(18),r=e.n(o),c=e(249),f={name:"UserIndex",head:function(){return{titleTemplate:"用户中心 - %s"}},data:function(){return{data:{},cardKey:"",cardLoading:!1,transformAffLoading:!1,auth_notification_status:"检测中···"}},computed:{auth_notification_status_color:function(){return"检测中···"===this.auth_notification_status?"warning":"已授权"===this.auth_notification_status?"success":"未授权"===this.auth_notification_status?"info":"danger"},url:function(){return window.location.origin}},watch:{"$store.state.user":function(t){t.id||this.$router.replace("/")}},mounted:function(){var t=this;setTimeout((function(){var n=t.$store.state,e=n.user,o=n.verify;!e.id&&o?(t.$message.error("请先登录"),t.$router.replace("/")):(t.getInfo(),t.webpush())}),0)},methods:{VerifyMail:function(){var t=this;this.$confirm("是否重新发送验证邮件？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.$store.commit("loadingComponent",!0),t.$axios.post("/user/verify_mail",{mail:t.data.mail}).then((function(){t.$notify.success({title:"发送成功",message:"请查看收件箱或垃圾箱"}),t.$store.commit("loadingComponent",!1)})).catch((function(n){t.$notify.error({title:"发送失败",message:n}),t.$store.commit("loadingComponent",!1)}))})).catch((function(){}))},logout:function(){var t=this;this.$store.state.user.id&&this.$confirm("是否退出登陆","确认信息").then((function(){t.$router.replace("/"),t.$store.commit("SET_STORE",{key:"user",value:{token:"",id:"",meta:{}}}),t.$store.commit("SET_STORE",{key:"vip",value:!1}),t.$message.success("退出成功")})).catch((function(){}))},getInfo:function(){var t=this;this.$axios.post("/user/info").then((function(n){t.data=n.data.data,t.data.verify||t.$notify.warning({title:"提示",message:"您的邮箱还未验证，请尽快验证，以免影响使用"})})).catch((function(n){t.$notify.error({title:"获取用户信息失败",message:n}),t.$store.commit("SET_STORE",{key:"user",value:{token:"",id:"",meta:{}}})}))},formatDate:function(t){return r()(t).format("YYYY-MM-DD")},activateCard:function(){var t=this;return!this.cardLoading&&(!!this.cardKey&&(this.cardLoading=!0,void this.$axios.post("/user/vip",{key:this.cardKey}).then((function(){t.cardLoading=!1,alert("激活成功，感谢您的支持"),t.$message.success("激活成功，感谢您的支持"),t.getInfo()})).catch((function(n){t.cardLoading=!1,alert("激活失败，可能是卡密输入错误或已使用过卡密，可查看VIP到期时间判断"),t.$notify.error({title:"激活失败",message:n})}))))},transformAff:function(){var t=this,n=Math.floor((this.data.aff-this.data.transform_aff)/5);return n<1?this.$notify.error({title:"兑换失败",message:"可兑换人数不足5人，无法兑换"}):!this.transformAffLoading&&void this.$confirm("预计可转换为".concat(n,"个月VIP"),"是否继续",{confirmButtonText:"确认转换",cancelButtonText:"取消",type:"warning"}).then((function(){t.transformAffLoading=!0,t.$axios.post("/user/transform_aff").then((function(n){t.transformAffLoading=!1,t.$notify.success({title:"转换成功",message:"获得".concat(n.data.data,"个月VIP")}),t.getInfo()})).catch((function(n){t.transformAffLoading=!1,t.$notify.error({title:"转换失败",message:n})}))})).catch((function(){}))},copy:function(text){var t=this;this.$copyText(text).then((function(){t.$message.success("复制成功")}),(function(){t.$message.error("复制失败，可手动进行复制")}))},webpush:function(){var t=this;this.$store.state.auth_notification?Object(c.a)().then((function(sub){var n=JSON.stringify(sub),data=JSON.parse(n);return t.$axios.post("/user/endpoint",{endpoint:data.endpoint,auth:data.keys.auth,p256dh:data.keys.p256dh})})).then((function(){t.auth_notification_status="已授权"})).catch((function(n){t.auth_notification_status="授权失败，请检查浏览器设置",console.log("授权通知失败",n)})):this.auth_notification_status="未授权"},re_webpush:function(){this.auth_notification_status="检测中···",this.$store.commit("SET_STORE",{key:"auth_notification",value:!0}),this.webpush()}}},l=(e(2608),e(5)),component=Object(l.a)(f,(function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"user-index"},[e("nya-container",{attrs:{title:"用户中心"}},[t.data.mail?e("div",{staticClass:"content"},[e("p",[e("b",[t._v("注册时间：")]),t._v(t._s(t.formatDate(t.data.unix)))]),e("p",[e("b",[t._v("ID：")]),e("el-tag",{staticClass:"cursor-pointer",attrs:{size:"small"},on:{click:function(n){return t.copy(t.data.id)}}},[t._v("\n                    "+t._s(t.data.id)+"\n                ")])],1),e("p",[e("b",[t._v("邮箱：")]),e("el-tooltip",{attrs:{effect:"dark",content:t.data.verify?"已验证，点击复制":"未验证，点击重新发送验证邮件",placement:"bottom"}},[e("el-tag",{staticClass:"cursor-pointer",attrs:{type:t.data.verify?"success":"danger",size:"small"},on:{click:function(n){t.data.verify?t.copy(t.data.mail):t.VerifyMail()}}},[t._v("\n                        "+t._s(t.data.mail)+"\n                    ")])],1)],1),e("p",[e("b",[t._v("VIP到期时间：")]),e("span",{staticStyle:{color:"red"}},[t._v(t._s(t.data.vip?t.formatDate(t.data.vip):"未开通"))])]),e("p",[e("b",[t._v("邀请人数 "),e("el-tooltip",{attrs:{effect:"dark",content:"每邀请5名用户可转换为1个月VIP会员",placement:"bottom"}},[e("el-button",{attrs:{size:"mini",round:"",loading:t.transformAffLoading},on:{click:t.transformAff}},[t._v(t._s(t.transformAffLoading?"转换中":"转换为VIP"))])],1),t._v("：\n                ")],1),t._v("共邀请了\n                "),e("b",{staticClass:"nya-c-theme"},[t._v(t._s(t.data.aff))]),t._v("\n                人，剩余可兑换VIP人数："),e("b",{staticClass:"nya-c-theme"},[t._v(t._s(t.data.aff-t.data.transform_aff))])]),e("p",[e("b",[t._v("邀请链接：")]),e("el-tooltip",{attrs:{effect:"dark",content:"点击复制",placement:"bottom"}},[e("el-link",{attrs:{type:"primary"},on:{click:function(n){return t.copy(t.url+"?aff="+t.data.id+"&ref=aff")}}},[t._v("\n                        "+t._s(t.url+"?aff="+t.data.id+"&ref=aff")+"\n                    ")])],1)],1),e("p",{staticClass:"mb-0"},[e("b",[t._v("授权本站发送通知：")]),e("el-tooltip",{attrs:{effect:"dark",content:"点击重新授权",placement:"bottom"}},[e("el-tag",{staticClass:"cursor-pointer",attrs:{type:t.auth_notification_status_color,size:"small"},on:{click:t.re_webpush}},[t._v("\n                        "+t._s(t.auth_notification_status)+"\n                    ")])],1)],1),e("hr"),e("p",[t._v("你可以通过"),e("b",[t._v(" 邀请用户注册 ")]),t._v("或"),e("b",[t._v(" 充值 ")]),t._v(" 成为本站VIP")]),e("div",{staticClass:"nya-subtitle"},[t._v("\n                输入 VIP 卡密激活 "),e("a",{attrs:{href:"http://pr.kuaifaka.com/item/N5Dgj",target:"_blank",rel:"noopener noreferrer"}},[t._v("点击购买卡密")])]),e("el-input",{staticClass:"mb-15",attrs:{autofocus:"",label:"",autocomplete:"off"},on:{keyup:function(n){return!n.type.indexOf("key")&&t._k(n.keyCode,"enter",13,n.key,"Enter")?null:t.activateCard(n)}},model:{value:t.cardKey,callback:function(n){t.cardKey="string"==typeof n?n.trim():n},expression:"cardKey"}},[e("el-button",{attrs:{slot:"append",loading:t.cardLoading},on:{click:t.activateCard},slot:"append"},[t._v("\n                    "+t._s(t.cardLoading?"激活中":"激活卡密")+"\n                ")])],1)],1):e("nya-loading"),t.$store.state.user.token?e("el-button",{attrs:{type:"primary",round:""},on:{click:t.logout}},[t._v("\n            退出登陆\n        ")]):t._e()],1),e("nya-container",{attrs:{title:"帮助"}},[e("ul",{staticClass:"nya-list"},[e("li",[t._v("卡密激活失败：仔细核对是否正确输入了卡密，请不要手动输入，直接复制粘贴即可")]),e("li",[t._v("激活后没有任何反应：可查看VIP到期时间，或刷新页面")]),e("li",[t._v("邮箱无法验证该怎么办：无需验证邮箱也可以正常使用，无需担心")]),e("li",[t._v("卡密忘记查询："),e("a",{attrs:{href:"https://www.kuaifaka.com/order_sel",target:"_blank",rel:"noopener noreferrer"}},[t._v("查询地址（只支持11月24日之后的订单查询）")])])])])],1)}),[],!1,null,null,null);n.default=component.exports}}]);