(window.webpackJsonp=window.webpackJsonp||[]).push([[99],{1184:function(t,e,o){var content=o(2346);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,o(13).default)("66071133",content,!0,{sourceMap:!1})},2345:function(t,e,o){"use strict";var l=o(1184);o.n(l).a},2346:function(t,e,o){(e=o(12)(!1)).push([t.i,".message_board .reply-item-content{display:inline-block;white-space:break-spaces}.message_board .no-msg{font-size:1.875rem;text-align:center;margin:2.5rem auto}.message_board .nya-loading{margin:3.125rem auto}.message_board .message_board-view-box .nya-subtitle span{font-weight:400}.message_board-header{padding:0 .625rem;display:flex;justify-content:space-between;align-items:center;margin-bottom:.625rem}.message_board .message-card{position:relative;min-width:17.5rem;display:inline-block;width:33.33333%;max-width:100%;min-width:18.75rem;padding:.625rem;box-sizing:border-box;cursor:pointer}@media (max-width:500px){.message_board .message-card{width:100%}}.message_board .message-card .message-card-body{border:.0625rem solid var(--border-color);border-radius:.3125rem}.message_board .message-card .header{display:flex;justify-content:space-between;border-bottom:.0625rem solid var(--border-color);padding:.625rem .9375rem}.message_board .message-card .header .type{font-weight:700;display:flex;align-items:center}.message_board .message-card .header .type span{margin-right:.3125rem}.message_board .message-card .header .type i{font-weight:700}.message_board .message-card .header .type i.eva-checkmark-circle-outline{color:var(--color-success)}.message_board .message-card .header .type i.eva-clock-outline{color:var(--color-danger)}.message_board .message-card .header .date{color:var(--color-text-placeholder)}.message_board .message-card .content{padding:.625rem .9375rem;word-break:break-all}",""]),t.exports=e},2754:function(t,e,o){"use strict";o.r(e);o(43),o(131),o(132),o(23),o(44);var l=o(2340),n=o.n(l),r=o(18),d=o.n(r),c=o(1147),m=o.n(c),v=o(71),h=o.n(v),y=(o(1148),o(191));d.a.locale("zh-cn"),d.a.extend(m.a);var _={name:"MessageBoard",data:function(){return{data:null,msnry:null,dialog:{show:!1,type:"问题反馈",content:"",mail:"",loading:!1,tools:"",private:!1,view:!1},viewData:{show:!1,tools:"",date:"",status:"",type:"",content:"",reply:"",id:"",replyData:{mail:"",content:""},md5:""},loading:!1}},computed:{toolsList:function(){var t=[];return this.$store.state.tools.forEach((function(e){t=t.concat(e.list)})),t.map((function(t){return t.name}))},verifyMail:function(){return Object(y.MD5)(this.viewData.replyData.mail.trim()).toString()===this.viewData.md5}},mounted:function(){this.getData(),this.$route.query.id&&h.a.isMongoId(this.$route.query.id)&&this.viewById(this.$route.query.id)},methods:{openAddMessageDialog:function(){this.dialog.mail=this.$store.state.user.meta.mail||"",this.dialog.show=!0},getData:function(){var t=this;this.loading=!0,this.data=null,this.$axios.get("/message_board/all",{params:{t:(new Date).getTime()}}).then((function(e){t.data=e.data.data,t.loading=!1,t.layout()})).catch((function(e){t.loading=!1,t.$notify.error({title:"获取数据失败",message:e})}))},layout:function(){var t=this;this.$store.state.isMobile||this.$nextTick((function(){t.msnry=new n.a(t.$refs["message-box"],{percentPosition:!0,itemSelector:".message-card"})}))},formatDate:function(t){return d()().from(d()(t))},formatDate2:function(t){return d()(t).format("YYYY-MM-DD HH:mm:ss")},add:function(){var t=this;h.a.isEmail(this.dialog.mail)||this.$notify.error({title:"提交失败",message:"请输入正确的邮箱联系方式"}),!this.dialog.content>=15&&this.$notify.error({title:"提交失败",message:"请输入留言信息，且不少于15个字"}),this.dialog.loading=!0;var e=JSON.parse(JSON.stringify(this.$store.state));delete e.env,delete e.tools,this.$axios.post("/message_board",{type:this.dialog.type,content:this.dialog.content,mail:this.dialog.mail,tools:this.dialog.tools,private:this.dialog.private,ua:navigator.userAgent,vuex:JSON.stringify(e),localStorage:JSON.stringify(this.$db.getState())}).then((function(){t.dialog.loading=!1,t.$notify.success({title:"提交留言成功",message:"站长看到后会及时回复"}),t.dialog.show=!1,t.getData(!0)})).catch((function(e){t.dialog.loading=!1,t.$notify.error({title:"提交失败",message:e})}))},view:function(t){this.viewData.show=!0,this.viewData.date=t.date,this.viewData.content=t.content,this.viewData.tools=t.tools,this.viewData.type=t.type,this.viewData.status=t.status,this.viewData.id=t.id,this.viewData.replyData.mail=t.mail||this.$store.state.user.meta.mail||this.$route.query.remail||"",this.viewData.replyData.content="",this.viewData.reply=t.reply,this.viewData.md5=t.md5,this.viewData.mail=t.mail},viewById:function(t){var e=this;this.$store.commit("SET_STORE",{key:"globalLoading",value:!0}),this.$axios.post("/message_board/view",{id:t}).then((function(t){var data=t.data.data;e.viewData.show=!0,e.viewData.date=data.date,e.viewData.content=data.content,e.viewData.tools=data.tools,e.viewData.type=data.type,e.viewData.status=data.status,e.viewData.id=data.id,e.viewData.replyData.mail=data.mail||e.$route.query.remail||e.$store.state.user.meta.mail||"",e.viewData.replyData.content="",e.viewData.reply=data.reply,e.viewData.md5=data.md5,e.viewData.mail=data.mail,e.$store.commit("SET_STORE",{key:"globalLoading",value:!1})})).catch((function(t){e.$notify.error({title:"获取数据失败",message:t}),e.$router.replace("/message_board",{id:void 0,remail:void 0}),e.$store.commit("SET_STORE",{key:"globalLoading",value:!1})}))},processed:function(t){var e=this;this.$store.commit("SET_STORE",{key:"globalLoading",value:!0}),this.$axios.post("/message_board/processed",{id:t}).then((function(){e.viewData.show=!1,e.getData(),e.$store.commit("SET_STORE",{key:"globalLoading",value:!1})})).catch((function(t){e.$notify.error({title:"操作失败",message:t}),e.$store.commit("SET_STORE",{key:"globalLoading",value:!1})}))},remove:function(t){var e=this;this.$store.commit("SET_STORE",{key:"globalLoading",value:!0}),this.$axios.post("/message_board/remove",{id:t}).then((function(){e.viewData.show=!1,e.getData(),e.$store.commit("SET_STORE",{key:"globalLoading",value:!1})})).catch((function(t){e.$notify.error({title:"操作失败",message:t}),e.$store.commit("SET_STORE",{key:"globalLoading",value:!1})}))},reply:function(){var t=this;return h.a.isEmail(this.viewData.replyData.mail)?this.verifyMail?this.viewData.replyData.content?(this.$store.commit("SET_STORE",{key:"globalLoading",value:!0}),void this.$axios.post("/message_board/reply",{id:this.viewData.id,mail:this.viewData.replyData.mail,content:this.viewData.replyData.content}).then((function(){return t.getData(),t.$axios.post("/message_board/view",{id:t.viewData.id})})).then((function(e){t.viewData.reply=e.data.data.reply,t.$store.commit("SET_STORE",{key:"globalLoading",value:!1}),t.$store.state.env.admin===t.$store.state.user.meta.mail?t.$notify.success({title:"提交回复成功"}):t.$notify.success({title:"提交回复成功",message:"站长看到后会及时回复"})})).catch((function(e){t.$notify.error({title:"回复失败",message:e}),t.$store.commit("SET_STORE",{key:"globalLoading",value:!1})}))):this.$notify.error({title:"提交失败",message:"请输入回复的内容"}):this.$notify.error({title:"提交失败",message:"当前邮箱与提交留言时的邮箱不一致"}):this.$notify.error({title:"提交失败",message:"请输入正确的邮箱"})}}},f=(o(2345),o(5)),component=Object(f.a)(_,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"message_board"},[o("el-dialog",{attrs:{title:"查看留言",visible:t.viewData.show,fullscreen:t.$store.state.isMobile,top:"15vh",width:"600px"},on:{"update:visible":function(e){return t.$set(t.viewData,"show",e)}}},[o("div",{staticClass:"message_board-view-box"},[o("div",[o("b",[t._v("留言ID：")]),o("span",[t._v(t._s(t.viewData.id))])]),t.viewData.mail?o("div",[o("b",[t._v("邮箱：")]),o("span",[t._v(t._s(t.viewData.mail))])]):t._e(),o("div",[o("b",[t._v("留言类型：")]),o("span",[t._v(t._s(t.viewData.type))])]),o("div",[t.viewData.private?o("b",[t._v("私密留言：")]):t._e(),o("span",[t._v(t._s(t.viewData.private))])]),o("div",[o("b",[t._v("日期：")]),o("span",[t._v(t._s(t.formatDate2(t.viewData.date)))])]),o("div",[o("b",[t._v("状态："),"pending"===t.viewData.status?o("span",[t._v("待处理")]):t._e(),"processed"===t.viewData.status?o("span",[t._v("处理完成")]):t._e()])]),o("div",[t.viewData.tools?o("b",[t._v("反馈工具：")]):t._e(),o("span",[t._v(t._s(t.viewData.tools))])]),t.viewData.reply.length?t._e():o("div",[o("b",[t._v("留言内容：")]),o("p",{domProps:{textContent:t._s(t.viewData.content.trim())}})]),t.viewData.reply.length?o("div",[o("hr"),o("div",{staticClass:"mb-15"},[o("b",[t._v("回复记录：")])]),o("div",{staticClass:"reply-list"},[o("el-timeline",[o("el-timeline-item",{attrs:{timestamp:t.formatDate2(t.viewData.date),color:"var(--theme)"}},[o("b",[t._v("用户留言：")]),o("div",{staticClass:"reply-item-content",domProps:{textContent:t._s(t.viewData.content.trim())}})]),t._l(t.viewData.reply,(function(e,l){return o("el-timeline-item",{key:l,attrs:{timestamp:t.formatDate2(e.date),color:"admin"===e.type?"var(--theme-danger)":"var(--theme)"}},[o("b",[t._v(t._s("admin"===e.type?"站长回复":"留言回复")+"：")]),o("span",{staticStyle:{"white-space":"pre-line"},domProps:{textContent:t._s(e.content.trim())}})])}))],2)],1)]):t._e(),t.$store.state.user.meta.mail===t.$store.state.env.admin?o("el-popconfirm",{attrs:{title:"确认删除这条留言吗？"},on:{onConfirm:function(e){return t.remove(t.viewData.id)}}},[o("el-button",{attrs:{slot:"reference",type:"primary"},slot:"reference"},[t._v("\n                    删除\n                ")])],1):t._e(),t.$store.state.user.meta.mail===t.$store.state.env.admin&&"pending"===t.viewData.status?o("el-popconfirm",{staticClass:"ml-10 mr-10",attrs:{title:"确认处理完成这条留言吗？"},on:{onConfirm:function(e){return t.processed(t.viewData.id)}}},[o("el-button",{attrs:{slot:"reference",type:"primary"},slot:"reference"},[t._v("\n                    处理完成\n                ")])],1):t._e(),o("el-divider",[t._v("回复留言")]),o("div",{staticClass:"nya-subtitle mt-15"},[t._v("\n                验证邮箱（与留言时使用的相同）\n            ")]),o("el-input",{staticClass:"mb-15",attrs:{type:"email",placeholder:"请输入邮箱",autofocus:"",clearable:""},model:{value:t.viewData.replyData.mail,callback:function(e){t.$set(t.viewData.replyData,"mail","string"==typeof e?e.trim():e)},expression:"viewData.replyData.mail"}}),t.verifyMail?o("div",{staticClass:"nya-subtitle mt-15"},[t._v("\n                回复内容\n            ")]):t._e(),t.verifyMail?o("el-input",{staticClass:"mb-15",attrs:{type:"textarea",autosize:{minRows:5,maxRows:8},placeholder:"请输入回复内容",autofocus:"",clearable:""},model:{value:t.viewData.replyData.content,callback:function(e){t.$set(t.viewData.replyData,"content",e)},expression:"viewData.replyData.content"}}):t._e(),o("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.reply(t.viewData.id)}}},[t._v("\n                回复\n            ")])],1)]),o("el-dialog",{attrs:{title:"添加留言",visible:t.dialog.show,fullscreen:t.$store.state.isMobile,top:"15vh",width:"600px"},on:{"update:visible":function(e){return t.$set(t.dialog,"show",e)}}},[o("div",{staticClass:"message_board-dialog-box"},[o("div",{staticClass:"nya-subtitle inline-title"},[t._v("\n                是否显示在留言板\n            ")]),o("el-switch",{attrs:{"active-value":!1,"inactive-value":!0},model:{value:t.dialog.private,callback:function(e){t.$set(t.dialog,"private",e)},expression:"dialog.private"}}),o("div",{staticClass:"nya-subtitle mt-15"},[t._v("\n                邮箱\n            ")]),o("el-input",{staticClass:"mb-15",attrs:{type:"email",placeholder:"请输入邮箱",autofocus:"",clearable:""},model:{value:t.dialog.mail,callback:function(e){t.$set(t.dialog,"mail","string"==typeof e?e.trim():e)},expression:"dialog.mail"}}),o("div",{staticClass:"nya-subtitle"},[t._v("\n                类型\n            ")]),o("el-select",{staticClass:"full-width mb-15",attrs:{placeholder:"请选择留言类型"},model:{value:t.dialog.type,callback:function(e){t.$set(t.dialog,"type",e)},expression:"dialog.type"}},[o("el-option",{attrs:{label:"问题反馈",value:"问题反馈"}}),o("el-option",{attrs:{label:"功能建议",value:"功能建议"}}),o("el-option",{attrs:{label:"其他",value:"其他"}}),o("el-option",{attrs:{label:"商务合作",value:"商务合作"}})],1),o("div",{staticClass:"nya-subtitle"},[t._v("\n                工具名称（可选）\n            ")]),o("el-select",{staticClass:"full-width mb-15",attrs:{placeholder:"请选择需要反馈的工具"},model:{value:t.dialog.tools,callback:function(e){t.$set(t.dialog,"tools",e)},expression:"dialog.tools"}},t._l(t.toolsList,(function(t,e){return o("el-option",{key:e,attrs:{label:t,value:t}})})),1),o("div",{staticClass:"nya-subtitle"},[t._v("\n                内容\n            ")]),o("el-input",{staticClass:"mb-15",attrs:{type:"textarea",autosize:{minRows:5,maxRows:8},placeholder:"请输入留言信息，如果是问题反馈必须输入复现步骤，否则无视留言。",autofocus:""},model:{value:t.dialog.content,callback:function(e){t.$set(t.dialog,"content",e)},expression:"dialog.content"}}),o("div",[o("el-button",{attrs:{type:"primary",loading:t.dialog.loading},on:{click:t.add}},[t._v("\n                    "+t._s(t.dialog.loading?"提交中":"提交留言")+"\n                ")])],1)],1)]),o("nya-container",{attrs:{title:"留言板"}},[o("div",{staticClass:"message_board-header"},[o("div",[o("span",[t._v("当前共有 "),t.data?o("b",[t._v(t._s(t.data.total))]):t._e(),t._v(" 条留言，已显示最近 "),o("b",[t._v("30")]),t._v(" 条")])]),o("div",[o("el-button",{attrs:{type:"primary"},on:{click:t.openAddMessageDialog}},[t._v("\n                    添加留言\n                ")])],1)]),t.loading?o("nya-loading"):t._e(),t.data&&!t.data.list.length?o("div",{staticClass:"no-msg"},[t._v("\n            暂无留言\n        ")]):t._e(),o("div",{ref:"message-box"},[t.data?t._l(t.data.list,(function(e,l){return o("div",{key:l,staticClass:"message-card",attrs:{title:"查看留言"},on:{click:function(o){return t.view(e)}}},[o("div",{staticClass:"message-card-body"},[o("div",{staticClass:"header"},[o("div",{staticClass:"type"},[o("span",[t._v(t._s(e.type))]),"processed"===e.status?o("i",{staticClass:"eva eva-checkmark-circle-outline"}):t._e(),"pending"===e.status?o("i",{staticClass:"eva eva-clock-outline"}):t._e()]),o("div",{staticClass:"date"},[t._v("\n                                "+t._s(t.formatDate(e.date))+"\n                            ")])]),o("div",{staticClass:"content"},[t._v("\n                            "+t._s(e.content)+"\n                        ")])])])})):t._e()],2)],1),o("nya-container",{attrs:{title:"说明"}},[o("ul",{staticClass:"nya-list"},[o("li",[o("b",[t._v("如果由于意外情况导致无法成功提交反馈，请邮件联系："+t._s(t.$store.state.env.admin))])]),o("li",[o("b",[t._v("类似留言或者垃圾留言将被删除，提交前请检查是否有类似的问题已存在")])]),o("li",[t._v("如果留言中包含附件（图片或视频），可以在 "),o("a",{attrs:{href:"https://send.eyhn.cloud/",target:"_blank",rel:"noopener noreferrer"}},[t._v("临时文件分享")]),t._v(" 中上传后再一并提交留言，"),o("b",[t._v("上传时记得修改到期时间为（7 天），下载次数修改为（∞ 次下载）")])])])])],1)}),[],!1,null,null,null);e.default=component.exports}}]);