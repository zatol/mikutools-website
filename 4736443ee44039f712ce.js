(window.webpackJsonp=window.webpackJsonp||[]).push([[165],{1031:function(t,e,n){"use strict";n(23);e.a=function(t){return new Promise((function(e,n){var o=new FileReader;o.readAsDataURL(t),o.onload=function(){return e(o.result)},o.onerror=function(t){return n(t)}}))}},1235:function(t,e,n){var content=n(2618);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(13).default)("eafcd4c2",content,!0,{sourceMap:!1})},2617:function(t,e,n){"use strict";var o=n(1235);n.n(o).a},2618:function(t,e,n){(e=n(12)(!1)).push([t.i,".what_anime_is_this .nya-subtitle{margin-top:.9375rem}.what_anime_is_this .preview{max-height:12.5rem}.what_anime_is_this table{color:#363636;border-collapse:collapse;border-spacing:0;width:100%}.what_anime_is_this table td{border:.0625rem solid #dbdbdb;padding:.5em .75em;vertical-align:top}.what_anime_is_this table td video{max-width:100%}",""]),t.exports=e},2677:function(t,e,n){"use strict";n.r(e);n(258);var o=n(1031),r=(n(23),{name:"WhatAnimeIsThis",head:function(){return this.$store.state.currentTool.head},data:function(){return{n:"",preview:"",file:null,docs:[],loading:!1}},methods:{handleChange:function(t){var e=this,n=t.target.files;if(!n.length)return!1;var r=n[0];this.docs=[],Object(o.a)(r).then((function(t){var image=new Image;image.src=t,image.onload=function(){var canvas=document.createElement("canvas"),t=canvas.getContext("2d");canvas.width=image.width,canvas.height=image.height,t.drawImage(image,0,0),e.preview=canvas.toDataURL(),function(t){return new Promise((function(e,n){fetch(t).then((function(t){return t.blob()})).then((function(t){var n=new File([t],"blob",{type:"image/jpeg"});e(n)})).catch(n)}))}(canvas.toDataURL()).then((function(t){e.file=t}))}}))},getAnime:function(){var t=this;if(!this.preview)return!1;this.loading=!0;var e=new FormData;e.append("image",this.file),this.$axios.post("https://trace.moe/api/search",e,{headers:{"Content-Type":"application/json"},auth:!1}).then((function(e){t.loading=!1,t.docs=e.data.docs})).catch((function(e){t.$notify.error({title:"识别失败",message:e}),t.loading=!1}))},secToTime:function(s){var t;if(s>-1){var e=Math.floor(s/3600),n=Math.floor(s/60)%60,o=s%60;t=e<10?"0"+e+":":e+":",n<10&&(t+="0"),t+=n+":",o<10&&(t+="0"),t+=o.toFixed(2)}return t},toPercent:function(t){var e=Number(100*t).toFixed(2);return e+="%"},myCount:function(){var t=this;if(this.loading)return!1;this.loading=!0,this.$axios.post("https://trace.moe/api/me",{},{headers:{"Content-Type":"application/json"},auth:!1}).then((function(e){t.loading=!1;var n=e.data;t.$notify.info({title:"剩余次数",message:"总次数剩余：".concat(n.quota," 每分钟剩余：").concat(n.limit)})})).catch((function(e){t.loading=!1,t.$notify.error({title:"获取失败",message:e})}))}}}),l=(n(2617),n(5)),component=Object(l.a)(r,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"what_anime_is_this"},[n("nya-container",{attrs:{title:"这是什么动漫"}},[n("div",{staticClass:"nya-subtitle mt-0"},[t._v("\n            请选择要识别动漫截图\n        ")]),n("el-input",{attrs:{type:"file",accept:"image/*",disabled:t.loading,placeholder:t.n?t.n.replace(/C:\\fakepath\\/,""):"点击这里上传文件"},nativeOn:{change:function(e){return t.handleChange(e)}},model:{value:t.n,callback:function(e){t.n=e},expression:"n"}},[n("el-button",{attrs:{slot:"append",loading:t.loading},on:{click:t.getAnime},slot:"append"},[t._v("\n                "+t._s(t.loading?"处理中":"开始处理")+"\n            ")])],1),t.preview?n("div",{staticClass:"nya-subtitle"},[t._v("\n            预览\n        ")]):t._e(),t.preview?n("img",{staticClass:"preview",attrs:{src:t.preview,alt:"preview"}}):t._e()],1),t._l(t.docs,(function(e){return n("nya-container",{key:e.index,attrs:{title:e.title_chinese+" EP#"+e.episode}},[n("table",[n("tbody",[n("tr",[n("td",[t._v("匹配位置：")]),n("td",[t._v(t._s(t.secToTime(e.at)))])]),n("tr",[n("td",[t._v("中文名称")]),n("td",[t._v(t._s(e.title_chinese))])]),n("tr",[n("td",[t._v("日文名称")]),n("td",[t._v(t._s(e.title_native))])]),n("tr",[n("td",[t._v("英文名称")]),n("td",[t._v(t._s(e.title_english))])]),n("tr",[n("td",[t._v("相似度")]),n("td",[t._v(t._s(t.toPercent(e.similarity)))])]),n("tr",[n("td",{staticStyle:{"text-align":"center"},attrs:{colspan:"2"}},[n("video",{attrs:{controls:"",loop:"",src:"https://trace.moe/preview.php?anilist_id="+e.anilist_id+"&file="+encodeURIComponent(e.filename)+"&t="+e.at+"&token="+e.tokenthumb}})])])])])])})),n("nya-container",{attrs:{title:"说明"}},[n("ul",{staticClass:"nya-list"},[n("li",[n("b",[t._v("请善于使用 "),n("nuxt-link",{attrs:{to:"/picture_clipping"}},[t._v("图片裁剪")]),t._v(" 更高效率的识别图片")],1)]),n("li",[t._v("\n                使用 trace.moe API，有使用次数限制。(\n                "),n("a",{on:{click:t.myCount}},[t._v("\n                    查看我的次数\n                ")]),t._v(")\n            ")]),n("li",[t._v("识别成功率取决于上传的截图")]),n("li",[t._v("多个相同/类似结果是因为返回的数据包含多个相同/类似结果")])])])],2)}),[],!1,null,null,null);e.default=component.exports}}]);